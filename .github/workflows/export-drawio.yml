name: Export draw.io Diagrams

# Runs on every push to main (or manual trigger).
# Exports each page in architecture.drawio to SVG and commits
# the result so README.md can embed them as static images.

on:
  push:
    branches: [main]
    paths:
      - "architecture.drawio"
      - ".github/workflows/export-drawio.yml"
  workflow_dispatch:   # allow one-click trigger from the GitHub Actions UI

permissions:
  contents: write      # required to push the exported SVGs back to the repo

jobs:
  export:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Export draw.io pages → SVG
        uses: rlespinasse/drawio-export-action@v4
        with:
          # path must be a DIRECTORY (action scans it for .drawio files)
          path: .
          format: svg
          # output is relative to each .drawio file's location;
          # architecture.drawio is at the root, so files land in docs/diagrams/
          output: docs/diagrams
          remove-page-suffix: false

      - name: Commit exported SVGs
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add docs/diagrams/
          git diff --staged --quiet || git commit -m "ci: export architecture.drawio → SVG [skip ci]"
          git push
